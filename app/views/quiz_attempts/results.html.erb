<div class="container mx-auto px-4 py-8">
  <div class="max-w-4xl mx-auto">
    <div class="text-center mb-8">
      <h1 class="text-3xl font-bold text-gray-800 mb-4">Quiz Complete!</h1>
      <p class="text-gray-600">Here are your results for: <strong><%= @quiz_attempt.quiz.topic.titleize %></strong></p>
    </div>

    <!-- Score Card -->
    <div class="bg-white rounded-lg shadow-md p-6 mb-8">
      <div class="text-center">
        <div class="text-6xl font-bold mb-4 <%= @final_score >= 80 ? 'text-green-600' : @final_score >= 60 ? 'text-yellow-600' : 'text-red-600' %>">
          <%= @final_score.round(1) %>%
        </div>
        <p class="text-xl text-gray-700 mb-4">
          <% if @final_score >= 90 %>
            🎉 Excellent! You're an expert in this topic!
          <% elsif @final_score >= 80 %>
            👏 Great job! You have strong knowledge in this area.
          <% elsif @final_score >= 60 %>
            👍 Good work! You have decent understanding with room for improvement.
          <% elsif @final_score >= 40 %>
            📚 Keep studying! You have basic knowledge but need more practice.
          <% else %>
            💪 Don't give up! Consider reviewing the fundamentals.
          <% end %>
        </p>
        <p class="text-sm text-gray-500">
          Score based on difficulty-weighted performance across 5 questions
        </p>
      </div>
    </div>

    <!-- Question Review -->
    <div class="bg-white rounded-lg shadow-md p-6 mb-8">
      <h2 class="text-xl font-semibold mb-6">Question Review</h2>
      
      <% @questions.each_with_index do |question, index| %>
        <% user_answer = @user_answers[question.id.to_s] %>
        <% is_correct = user_answer == question.correct_answer %>
        
        <div class="mb-6 pb-6 <%= 'border-b' unless index == @questions.count - 1 %>">
          <div class="flex items-start justify-between mb-3">
            <h3 class="text-lg font-medium text-gray-800">Question <%= index + 1 %></h3>
            <div class="flex items-center space-x-2">
              <span class="inline-block bg-gray-100 text-gray-800 text-xs px-2 py-1 rounded">
                Difficulty: <%= "★" * question.difficulty_level %>
              </span>
              <span class="inline-block <%= is_correct ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800' %> text-xs px-2 py-1 rounded">
                <%= is_correct ? '✓ Correct' : '✗ Incorrect' %>
              </span>
            </div>
          </div>
          
          <p class="text-gray-700 mb-4"><%= question.content %></p>
          
          <div class="grid grid-cols-1 md:grid-cols-2 gap-2">
            <% question.answer_options_array.each do |option_key, option_text| %>
              <% is_user_choice = user_answer == option_key %>
              <% is_correct_answer = question.correct_answer == option_key %>
              
              <div class="p-3 rounded border <%= 
                if is_correct_answer
                  'bg-green-50 border-green-200'
                elsif is_user_choice && !is_correct_answer
                  'bg-red-50 border-red-200'
                else
                  'bg-gray-50 border-gray-200'
                end
              %>">
                <span class="font-semibold"><%= option_key %>:</span> <%= option_text %>
                <% if is_correct_answer %>
                  <span class="text-green-600 text-sm ml-2">✓ Correct</span>
                <% elsif is_user_choice %>
                  <span class="text-red-600 text-sm ml-2">Your choice</span>
                <% end %>
              </div>
            <% end %>
          </div>
        </div>
      <% end %>
    </div>

    <!-- Actions -->
    <div class="flex justify-center space-x-4">
      <%= link_to "Take Another Quiz", new_quiz_path, class: "bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-6 rounded" %>
      <%= link_to "Retake This Quiz", quiz_quiz_attempts_path(@quiz_attempt.quiz), method: :post, class: "bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-6 rounded" %>
      <%= link_to "← Back to Quizzes", root_path, class: "text-gray-600 hover:text-gray-800 font-medium py-2 px-6" %>
    </div>
  </div>
</div>